# Frontend Specification - React Router 7 with Native SSR

## Overview
Server-side rendered React stocks application using React Router 7's native SSR support that fetches stock data from Google's Gemini API using route loaders.

## Architecture
- **Framework**: React with React Router 7 (Remix merged)
- **Routing**: React Router 7 with native SSR and data loading
- **Port**: 3000 (React Router 7 dev server)
- **Data Source**: Google Gemini API called via route loaders
- **Build**: React Router 7 production build with SSR

## Routes (React Router 7)

### / (Home Route)
- **Component**: HomePage
- **Purpose**: Displays list of stock symbols
- **Data**: Static list (no loader needed)
- **Features**: Plain text stock symbol list, navigation to individual articles

### /stock/:symbol (Stock Article Route)
- **Component**: StockPage
- **Loader**: Fetches article data from cache or Gemini API
- **Purpose**: Displays individual stock article
- **Data**: Retrieved via useLoaderData() hook
- **Features**: Article content (if available), stock info, back to home navigation
- **Empty State**: Shows nothing if loader returns null
- **Error**: 404 component for non-existent stock symbols


## File Structure
```
apps/
  stocks/
    package.json
    react-router.config.ts
    app/
      root.tsx
      routes.ts
      routes/
        _index.tsx
        stock.$symbol.tsx
      components/
        Layout.tsx
      services/
        geminiService.ts
        cacheService.ts
    .cache/
      articles/
        # Cached article files (e.g., AAPL.json)
    .gitignore
```

## Component Structure

### root.tsx (Root Layout)
- React Router 7 root component
- Global layout and providers
- Outlet for route content
- Error boundaries

### routes/_index.tsx (HomePage)
- Stock symbol list display
- Plain text list of stock symbols
- Link components to individual stock articles
- No loader needed (static data)

### routes/stock.$symbol.tsx (StockPage)
- **Loader function**: Fetches article data from cache/Gemini API
- **Component**: Displays article content using useLoaderData()
- Stock information header
- Article text with proper formatting
- Back navigation
- Empty state handling when loader returns null

### components/Layout.tsx (Shared Layout)
- Common header/footer structure
- Navigation components
- Reusable layout components

## Data Structure
- **Stock Symbols**: Static array of stock symbols
- **Article Content**: Generated by Gemini API during SSR and cached locally
- **Stock Info**: Real-time stock information fetched via Gemini API during SSR
- **Cache**: File-based cache for article content

## Dependencies
- react: UI library
- react-dom: DOM rendering
- @react-router/dev: React Router 7 development tools
- @react-router/node: React Router 7 Node.js adapter
- react-router: React Router 7 core
- typescript: Type checking
- @google/genai: Gemini API client (v2)
- dotenv: Environment variable management

## Scripts
- `npm run dev`: React Router 7 development server with SSR
- `npm run build`: Production build
- `npm run start`: Production server

## React Router 7 Configuration
- react-router.config.ts: Main configuration file
- app/root.tsx: Root layout component
- app/routes.ts: Route definitions
- SSR enabled by default with route loaders

## Data Loading (React Router 7 Loaders)
- **Route Loaders**: Data fetching functions exported from route files
- **Server-side execution**: Loaders run on server during SSR
- **Client-side navigation**: Loaders called automatically via fetch on navigation
- **useLoaderData()**: Hook to access loader data in components
- **Cache-first strategy**: Check cache before calling Gemini API
- **Automatic serialization**: Data automatically passed between server and client

## Caching Strategy
- **Implementation**: Custom file-based cache service
- **Cache Location**: `.cache/articles/` directory
- **Cache Key**: Stock symbol (e.g., `AAPL.json`)
- **Cache Duration**: Configurable (e.g., 24 hours)
- **Cache Flow in Route Loaders**:
  1. Loader checks if cached article exists for symbol
  2. If exists and not expired, return cached data
  3. If not exists or expired, fetch from Gemini API
  4. Cache the new response
  5. If API fails and no cache, return null

## Gemini Integration (v2)
- **API Key**: Stored in environment variables
- **Model**: Uses gemini-2.0-flash model with Google Search tools
- **Usage Pattern**:
  ```typescript
  import { GoogleGenAI } from "@google/genai";
  
  const ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY });
  const response = await ai.models.generateContent({
    model: "gemini-2.0-flash",
    contents: [prompt],
    config: {
      tools: [{googleSearch: {}}],
    },
  });
  const content = response.text;
  ```
- **React Router 7 Integration**:
  - Called in route loader functions
  - Check cache before API call
  - Data automatically serialized between server and client
  - Results cached and returned from loader
- **Google Search Integration**: 
  - Real-time web search for current stock data
  - Grounding metadata available for accuracy
- **Prompts**: 
  - Stock article generation with current market data
  - Real-time stock information retrieval
- **Error Handling**: Return null from loader if API fails and no cache

## Environment Variables
- `GEMINI_API_KEY`: Google Gemini API key
- Set in .env file at project root

## Styling
- CSS modules or styled-components
- Responsive design
- Simple list styling for stock symbols
- Typography for article readability
- Navigation components
- Mobile-friendly layout